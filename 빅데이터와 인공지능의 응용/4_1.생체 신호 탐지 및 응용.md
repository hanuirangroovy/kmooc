# 4주차. 일상의 의료 서비스 응용

## 4-1. 생체 신호 탐지 및 응용

- 헬스케어의 진보
  - clinical application
    - 병원에서 환자 관리, 진단, 수술을 돕는 애플리케이션
  - 병원에 가기 전 일상 생활에서 평상시의 건강을 챙겨주기 위한 애플리케이션

- 심박 및 호흡 탐지
  - PPG 센서 : 손가락 끝을 덮어 심박을 재는 센서
    - 비침습적으로 심박을 잴 수 있는 가장 흔한 사용 기술 주 ㅇ하나
    - 이 기술의 intuition은 심장이 펌핑해서 피를 곳곳에 보내게 될 떄 혈류량의 급격한 변화가 나타나는데 빛을 쏴서 혈류량의 변화를 측정함으로써 심장 뛰는 속도 혹은 그 리듬에 대해 탐지
    - PGG 센서는 두 가지 큰 컴포넌트로 구성
      - 녹색불빛을 쏘는 LED
      - 녹색 빛을 캡처하기 위한 포토 다이오드
    - 녹색 LED에서 혈관 쪽으로 빛을 쏘게 됨. 그리고 이 혈류량에 따라 빛이 반사되어 나오는 양이 달라짐
    - 포토 다이오드가 빛의 양을 계속서 캡쳐 해 심장이 펌핑을 해가지고 혈류가 굉장히 많이 흐르게 될 때는 빛을 많이  반사
    - 그 반대가 될 때는 빛을 적게 반사하게 됨. 그래서 이 빛의 반사량을 통해 심박을 탐지
    - 심장이 펌핑 할 떄는 시스톨릭 포인트라고 해서 혈류량이 혈관에 굉장히 급격하게 증가하게 되고 PPG에서 탐지하는 빛의 양이 급격히 증가하는 것을 볼 수 있음. 다이어스톨릭 포인트라고 해서 심장이 다 펌핑을 마치고 피가 다 나갔을 때 혈류량이 줄어들면서 그 반사되어서 나오는 빛의 양이 급격히 줄어들게 됨. 그래서 시스톨릭 포인트와 다이어스톨릭 포인트를 탐지 하게 되면 빛, 심박 간의 간격을 알아낼 수 있고 이 간격을 알아낸다는 이야기는 심박수를 알아낼 수 있다는 이야기
    - PPG 시그널로부터 하트트레이트를 디텍터하는 과정에서는 매 프레임당 에버리지 그린 인텐시티를 얻게 되는데 에버리지 값을 얻는 이유는 PPG에서 센싱하는 벨류는 한 가지 값이 아니고 이미지임. 그래서 이미지에 있는 그린 값들을 그린 벨류들의 에버리지를 구하게 됨. 그 다음에 심박수를 고려해 0.7초 정도의 윈도우를 잡아서 가장 높은 값을 탐지. 이거를 심박의 피크를 PPG 시그널의 피크로 감지
    - 감지 후에는 간극 간격을 구하게 되는데 이 간격을 RR인터벌이라 부름
    - RR인터벌을 구하게 되면 RR인터벌을 60초로 나누게 돼서 원하는 심박값을 얻게 됨
    - PPG센서 같은 경우 굉장히 비침습적으로 간단한 기술을 통해 우리의 심박수를 잴 수 있는 기술이기에 많은 디바이스에 점차 많이 들어가고 있고 활용도 높은 센서
    - PPG센서로부터 한 가지 탐지할 수 있는 것은 심박 뿐 아니라 호흡
      - Respiratory sinus arrhythmia(RSA)에 기반을 둠
        - 호흡을 할 때 숨을 들이쉴 때 심박이 순간적으로 빨라지고 내쉴 때 심박이 순간적으로 느려지는 패턴이 계속적으로 반복
        - 이 현상 활용해 심박수 디텍트
        - 심박 간의 인터벌을 디텍트 할 수 있기때문에 이 기술과 이런 인튜이션을 합치면 호흡을 PPG를 활용해 호흡을 탐지해내는 게 가능
        - 심박탐지에서 프레임당 그린 에버리지 그린 인텐시티를 얻게되고 FFT를 수행하게 됨
        - FFT를 수행하게 되면 이 시그널에서 가장 도미넌트한 프리퀀시를 알 수 있게 됨
        - 아이디얼리 FFT를 수행하면 프리퀀시도메인 상에서 두 번의 피크를 고나찰할 수 있게 되는데 하나의 피크는 하트 트레이트랑 매핑이 돠고 더 느린 다른 하나는 브리딩 레잇이랑 매칭이 되게 됨
        - 이런 방식을 통해 가지고 호흡수까지 PPG를 통해 알아낼 수 있음
    - 스마트와치 : 와치 뒷면에 포토 다이오드와 그린 LED를 집어 넣어 심박 탐지
  - PPG센서를 넣지 않더라도 일상에서 쓰는 카메라와 플래시로도 PPG와 같은 원리로 심박을 탐지할 수 있게 됨
    - 플래시를 휴대폰에 키고 손가락을 가져다 대게 되면 흰색 불빛이 RGB 값을 다 가지고 있기에 그린 값을 읽어내게 되면 똑같은 원리로 심박 탐지
    - 스마트폰 카메라로 찍으면 심장이 펌핑할 때 얼굴이 붉어졌다가 릴렉스 될 때 하얗게 변하는 주기적인 패턴을 관찰할 수 있게 되고 이걸 바탕으로 심박 탐지
  - ECG 센서
    - 뇌에서 심장으로 보내는 전기 신호를 탐지해 심박 탐지
    - 이렇게 아이디얼리는 P, Q, R, S, T 등 5가지 정도의 피크를 볼 수 있음
    - 이 피크들 간의 간극은 심장의 모양이라든지 어떤 심장에서 심장들이 각 심장들이 펌핑하는 그런 과정을 나타냄
    - 심장에 대한 문제점을 알아낼 수 있는 부정맥, 심장 기형, 칼디악 벨브 디지즈, 심장의 어떤 혈관이라든지 근육들의 문제점들을 파악할 수 있는 애플리케이션도 만들 수 있음
    - ECG 시그널이 뇌에서부터 나오는 전기 신호이기 때문에 활용한다면 심장의 문제뿐만 아니라 우리의 감정 상태, 스트레스 등을 알아낼 수 있는 애플리케이션들 가능
    - ECG를 센싱해가지고 하트비트를 디텍트를 하고 그다음에 하트비트 주로 분당 심박수보다도 심박의 변화를 탐지하고 그 변화의 로우 프리퀀시 값과 하이 프리퀀시 값을 얻게 되면 이모션을 얻어낼 수 있다는 연구 결과들이 많이 있음. 이렇게 감정 상태, 스트레스 등을 탐지하는 데 굉장히 중요한 시그널
    - ECG 센싱은 몸의 여러 곳의 전기신호를 탐지하는 것이기에 전극을 붙이게 되고그 전극에서 오는 탐지되는 전기신호를 가지고  ECG 파형을 그림
    - 손가락 쪽에 전극을 하나 붙여서 두 개의 이상의 전극을 활용하게 되면 병원에서 사용하는 품질의 ECG 시그널을 탐지할 수는 없지만 굉장히 유의미한 ECG 시그널을 얻을 수 있게 됨
    - 파형을 얻게 되면 파형으로부터 피크값들을 얻어내는 것이 굉장히 중요
    - 피크는 R 피크가 심박을 탐지하는 데 가장 중요한 역할을 하고 그밖에 P, Q, S, T 피크도 다른 중요한 의미를 지니기 때문에 이 5개의 피크를 다 탐지해내는 게 중요
    - 그런데 흔히는 일상 실제 디바이스에서 얻는 ECG 시그널은 조금 더 복잡하기 때문에 각종 필터를 사전에 적용을 해준다든지 프리프로세싱 테크닉을 적용을 해준다던지 하는 일이 필요
    - 이 피크를 탐지하고 나면 피크로부터 심박을 얻어내는 것은 굉장히 간단한 일이 됨. 심박을 탐지할 때는 피크 중에 가장 큰 피크인 R 피크를 이용하게 되는데 두 개의 R 피크 사이의 인터벌을 구하게 됨. 이걸 RR 인터벌이라고 부르는데 60을 RR 인터벌 값으로 나누게 되면 하트 트레이트를 얻을 수 있게 됨
    - 서로 다른 피크 간의 인터벌들을 탐지하게 되면 심장의 어브노어멀리티, 스트레스,  감정 상태 등을 탐지하는 데 유용하게 활용할 수 있음
- 생체 센서
  - EDA 센서 혹은 GSR 센서
    - galvanic skin response라고 해서 이 센서가 탐지하는 것은 피부의 두 점 사이의 전기전도성
    - 우리가 어떤 감정적인 각성 상태에 있다거나 아니면 뇌에 굉장히 인지활동을 많이 하는 상태가 되면 우리도 모르게 몸의 피부에 땀이 나게 되는데 땀이 난다고 느끼지 않더라도 피부 바로 밑에 있는 땀구멍들이 감정적인 각성 상태나 인지활동이 많은 상태에서는 땀구멍들이 매꿔지게 되고 이 땀구멍들이 매꿔지게 되면 피부의 두 점 사이에 전기 신호가 더 많이 흐를 수 있게 됨
    - 피부의 두 점 사이에 전기 신호가 흐르는 정도를 탐지하게 되면 우리가 감정적으로 어라우즈 되어있다 혹은 뇌에서 인지활동을 굉장히 많이 하고 있다 이런 거를 탐지할 수가 있게  됨.
    - EDA 센서 같은 경우에는 두 가지 컴포넌트들이 있음
      - 한 가지는 굉장히 천천히 변하는 그런 컴포넌트고 스킨 컨덕텐스 레벨
        - 자율신경계의 각성 상태를 일반적으로 굉장히 롱텀에서 변화하는 자율신경계의 각성 상태를 측정하는 컴포넌트
      - 다른 한 가지 더 많이 사용하는 경우에는 좀 더 숄텀으로 페이직하게 변하고 그리고 어떤 자극이 있을 때 바로 변화가 나타나는 스킨 컨덕텐스 리스폰스 컴포넌트
        - 어떤 자극이 우리한테 들어왔을 때 SCR 컴포넌트가 EDA 센싱의 SCR 컴포넌트가 변하게 되는데 그러면 특정 시간이 지나가지고 EDA 값이 스킨 컨덕턴스 레벨이 올라가게 됨. 그랬다가 다시 이 자극이 발생한 지 시간이 좀 지나게 되면 다시 이 스킨 컨덕턴스 레벨이 떨어지게 됨
        - 그래서 자극으로부터 스킨 컨덕턴스 레벨이 올라가기까지 걸리는 시간 그리고 얼마나 높이 올라가는지 그게 떨어지는 데 얼마만큼의 시간이 걸리는지 이런 것들이 감정이나 혹은 인지상태를 나타내주는 중요한 피쳐들이 되고 이런 걸 활용해가지고 응용을 만드는 사례들이 많이 출현
  - EEG 센서
    - 우리 뇌에서 나오는 뇌파를 센싱하는 장비
    - 예전에는 물에 젖은 전극들을 뇌에 수십개를 붙여가지고 뇌파를 탐지
    - 요즘은 이게 너무 침습적이고 특정 특수한 환경에서만 활용을 할 수 있게 되다 보니까 EEG 센싱을 손쉽게 할 수 있는 그런 장치들이 많이 출현
    - 전극의 수를 줄이고 그리고 웻 전극 젖은 전극이 아니라 드라이 전극 마른 전극을 활용해가지고 EEG 센싱을 하기 위한 장비들이 많이 나오고 있음
    - 그래서 이어폰의 헤드셋의 형태라든지 아니면 머리띠 형태라든지 이런 형태로 EEG 센서들이 많이 출현
    - 이걸 가지고 명상을 하는데 뇌의 릴렉스된 상태를 탐지해가지고 명상을 잘 할 수 있게 도와준다든지 아니면 수면의 품질을 탐지한다든지 이런 애플리케이션들이 출현하고 있음.