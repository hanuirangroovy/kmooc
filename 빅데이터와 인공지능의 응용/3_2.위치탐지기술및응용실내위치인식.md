# 3주차. 인간 행동 탐지 및 응용➁

## 3-2. 위치 탐지 기술 및 응용 실내 위치 인식

- 실내 위치 인식 기술
  - 실내에서는 GPS 시그널이 투과돼서 들어올 수 없기 때문에 GPS 활용해서 실내 위치를 정확히 알아내지 어렵
  - 요즘 도심 공간상에서의 사람들의 삶을 보면 실내에서의 생활이 훨씬 큰 비중을 차지하고 있음
  - 복잡한 쇼핑몰 같은 데서 유용한 위치기반의 서비스를 하기 위해서는 실내의 위치를 최소한 가게 단위로라도 알아낼 수 있는 기술 필요
  - GPS를 동작하지않고 실내에서 활용해서 하면 좋다라는 기술이 아직 없음
- 실내 위치 알아내게 됐을때 제공 가능한 서비스
  - 실내 내비게이션
  - 어떤 공간에 사람이 많은지를 감지해서 줄을 어디에 어떤 가게에 많이 서는지 탐지해서 식당 추천
  - 화장실 등 공간이 얼마나 자주 사용되는지 얼마나 많은 사람들에게 사용되는지 실시간으로 모니터링해서 청소를 적시에 해줄 수 있는 서비스

- Common Localization Approaches

  - Trilateration
    - base station으로부터 오는 시그널의 각도를 계산해서 그 각도를 바탕으로 위치를 인식해내는 방식
  - Triangulation
    -  GPS 활용방식으로 여러개의 base station으로부터 신호를 받고 시간 차이를 계산해서 그걸로부터 거리를 계산하고 그 거리를 바탕으로 위치를 계산
    - 여러개의 base station에서 위치를 탐지하고자 하는 디바이스로 신호를 쏘게 되고 보내는 시간 받는 시간을 알게 되면 이 차이를 활용해서 거리를 알게 됨
    - 2d space에서 위치탐지를 위해서는 똑같이 3개의 레퍼런스 시그널이 필요하고 3d 공간에서의 위치탐지를 위해서는 4개의 레퍼런스 시그널 필요
  - RSSI-based
    - Received Signal Strength Indicator라는 RSSI value를 바탕으로 하는 위치탐지 기술
    - 특정 base station에서 특정 세기로 신호를 보내게 되는데 이 신호는 공간을 traveling하면서 신호의 세기가 점점 약해지게 됨. 신호를 받는 디바이스에서 신호의 세기가 얼마나 되는지를 알면 신호 세기가 처음 보낸거에서부터 받는 데까지 얼마나 감소했는지를 바탕으로 거리를 측정할 수 있게 되고 그 정보를 바탕으로 다시 location을 인식할수 있는 기술
    - 이 방법의 어려운 점은 신호가 감소하는 거리에 따라서 그 감소하는 패턴을 모델링해내는 게 쉬운 일이 아니라는 거. 신호가 프리하게 오픈 스페이스로 퍼져나간다고 가정할떄 동작하는 방식인데 흔히 인도어는 그런 환경이 아님. 주변에 벽, 물건이 많고 사람이 왔다갔다하면 신호 세기를 모델링 하는게 어렵.
    - RSSI Fingerprint-based Localization
      - 신호 세기를 다른 방식으로 활용할 수 없을까하고 생각하다 신호 세기를 활용할 때 핑거프린트 방식이 출현
      - 내가 탐지하고자 하는 위치에 미리 가서 어떤 base station으로부터 오는 신호 세기가 얼마나 되는지를 미리 재놓다 보면 어느 구역이 신호의 세기가 약하고 센 지 RSSI 지문이 생김. 이런 지문을 위치별로 사전에 확보. 그러면 신호세기를 모델링 할 필요X

- A Few Example System

  | Name of the system | Built by           | Signaling technique | Approach        |
  | ------------------ | ------------------ | ------------------- | --------------- |
  | Active Bat         | Univ. of Cambridge | Ultrasound          | Trilateration   |
  | Criket             | MIT                | Ultrasound + RF     | Proximity-based |
  | RADAR              | Microsoft          | WiFi                | RSSI-based      |
  | HORUS              | Univ.of Maryland   | WiFi                | RSSI-based      |



- Active Bat
  - 천장에 초음파를 수신할 수 있는 비콘들을 그리드 형태로 붙여 놓고 사용자가 초음파를 보낼 수 있는 디바이스를 들고 다님
  - 디바이스에서 초음파를 보내게 되고 나면 천장에 있는 비콘들에서 이 신호를 캡쳐하게 되고 신호를 보낸 시간과 신호를 받은 시간의 차이를 알아내서 거리를 알아냄
  - 여러 개의 디바이스와의 거리를 알아내게 되면 트라이레테이션을 통해서 디바이스의 위치를 인식
  - 이 방식을 굉장히 촘촘하게 그리드를 배치해서 3cm정도의 resolution이 나올 수 있다는 것을 보여줌
  - 단점 : 사용자가 초음파를 발산할 수 있는 기계를 따로 가지고 다녀야 되고 천장에 이 초음파를 수신할 수 있는 기계들을 촘촘하게 배치해야 됨
- Criket
  - 천장이나 공간상에 약 방에 한 두개정도로 sperse하게 디바이스를 배치
  - 환경에 붙어있는 기계들이 신호를 보내게 되고 이 봰 신호에 자기의 위치를 담아 신호 보냄
  - 정확히 좌표를 계산해내는 시스템이 아니라 몇 호에 있다 이런 종류의 정보를 탐지하기 위한 시스템
  - 수신된 정보를 바탕으로 어디 어느 비콘이 나와 가장 가까운지를 결정. 가장 가까운 비콘의 위치를 나의 위치로 결정 하게 됨
  - 크리켓 기술에서 핵심 중에 하나는 비콘과 디바이스 사이의 거리를 어떻게 알아낼 거냐라는 게 핵심질문
    - 이 거리를 알아내는 방식으로 사람들이 제안하는 건 RF시그널과 ultrasound signal을 동시에 보내게 되는 것
    - RF 시그널은 빛의 속도로 travel하는 시그널이고 ultrasound는 소리의 속도로 travel하는 시그널이기에 RF시그널은 보낸 순간에 바로 도착한다고 보면 됨
    - 그래서 RF signal의 도착 시간과 ultrasound의 도착 시간의 차이를 비교하게 되면 비콘까지의 거리를 대략적으로 유추해낼 수 있음
    - 여러 비콘으로부터 이런 두 가지 신호 정보를 받아서 거리를 계산하고 거리가 가장 짧은 비콘을 나의 위치로 정하게 되는 그런 시스템
- Active Bat vs Criket
  - Active Bat 
    1. 디바이스에 신호르 보내서 reciever들이 이 신호를 탐지해서 위치 계산
    2. 더 정확한 위치 계산 가능
  - Criket 
    1. 그 반대. 고로 크리켓이 조금더 프라이버스 perserving이 낫고 다수의 디바이스를 커버할 수 있다
  - 둘 다 특정 신호를 받거나 보낼 수 있는 리시버들 혹은 sender들을 공간상에 설치 해야한다는 문제 있음. 그래서 나온 방식이 WiFi
- RADAR
  - 와이파이를 활용한 가장 초장기 시스템
  - 두 가지 페이즈로 작동
    - 오프라인 페이즈에서는 와이파이 시그널에 signal fingerprint signal 지문을 쭉 빌드해놓게 됨. 탐지하고자 하는 위치에 있는 디바이스들을 사전에 이 위치들에 방문해서 그 위치에서 신호 지문을 뜨게 만듦. 이 위치에서 두 액세스 포인트로부터 signal strength를 재보고 위치별로 신호지문 뜨게 만듦
    - 온라인 페이즈에서는 디바이스가 현재 위치에서의 신호세기를 츠겆ㅇ. 그 다음에 신호 세기가 사전의 핑거프린트 된 어떤 위치에서으 ㅣ신호 세기와 가장 가까운지  살펴 봄
  - 장점 : 사전에 픵거프린팅하는 작업을 거쳐야 하지만 많은 건물들이 이미 와이파이 개세스 포인트를 다수 확보하고 있기에 디바이스들을 새로 설치하지 ㅇ낳고 기존에 있는 디바이스를 활용해서 위치 탐지 가능
  - 문제점 : 레이더에서는 특정 액세스 포인트로부터의 평균 신호 세기를 활용했는데 신호 세기가 시간에 따라서 일정하지 않다는 것. 같은 위치에서 같은 액세스 포인트로부터의 신호세기를 재도 그 신호의 변동 폭이 상당히 있음. 에버리지를 사용하기에 큰 편차는 일어나지 않겠지만 그래도 신호의 세기에 차이가 생길 수 있게 되고 그러면 위치 탐지가 정확하게 이루어지지 않는 문제가 발생할 수 있음
  - RADAR의 문제점을 해결하기 위해  HORUS 시스템이 제안됨
- HORUS
  - key idea : 각 위치에서 signal strength의 평균값으로 신호의 지문을 쭉 해놓는 게 아니라 그 위치에서 신호의 히스토그램 분포를 핑거프린팅 해 주게 됨
- 요즘 가장 흔히 사람들이 활용하고자 하는 시스템은 와이파이를 기반으로 한 시스템
  - 추가적으로 기기를 설치하지 않고 위치를 탐지할 수 있기에
- Continuous Localization
  - 연속적으로 트래킹해야 되는 경우 히스토리를 볼 수 있고 이 얘기는 에러를 줄일 수 있는 가능성이 엄청나게 높아지게 된다는 것
  - 관련 기술 : Dead reckoning, Particle filters, viterbi

- 와이파이 기반이 아니라 visible light를 활용한 위치 탐지 기술도 출현
  - 와이파이 액세스 포인트는 되게 넓게 방마다 하나 혹은 몇 개의 방마다 하나씩 배치되어 있어 아무리 알고리즘을 잘 발전시킨다해도 액세스 퐁니트가 넓게 분포된 지역에서는 위치의 정확도를 확보하기가 근원적으로 힘듦
  - 전구가 앞으로 smart bulb로 바뀌게 된다면 전구를 프로그램 할 수가 있게 됨

