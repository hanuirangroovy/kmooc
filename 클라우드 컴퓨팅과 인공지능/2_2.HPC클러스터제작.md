# Week2. 클라우드 컴퓨팅과 인공지능 환경

## 2.1. HPC 클러스터(Cluster) 제작

- 클러스터(Cluster)
  - 전체는 하나의 컴퓨터 시스템인데 내부는 여러 개의 컴퓨터가 공동으로 움직여서 계산하는 구조
  - 올해 6월 기준 세계에서 가장 빠른 컴퓨터 = SUMMIT-OAKRIDGE NAT.LABS., USA
    - 그래픽 프로세싱 유닛, GPU들이 몇 만개가 같이 동작. 프로세서, 가속 장치도 있고 규모가 이 둘이 하나의 보드 내에 붙어 있을 때, 그 보드를 9천 장 이상을 동작시켜 얻은 결과가 150 PFLOPS(피타플롭스)에 해당
  - 씨에라 SIERRA - LAWRENCE L. NAT. LABS. USA
    - 가속장치 따로 없이 코어 개수로 150만 개가 동작하는 컴퓨터.
    - 1위에 비해 2/3 수준, 94PFLOPS
  - SUNWAY TAIHULIGHT - CHINA SUP. CTR., CHINA
    - 코어 개수가 천 만개의 코어가 존재. 93PFLOPSP. 
  - 구조가 다 클러스터로 되어 있음
  - 9천 여개의 집합 보드로 이루어진 캐비넷. 이 전체가 동일한 연산을 나누어서 작업을 진행하는 클러스터 구조를 가짐
  - 20년간 컴퓨터 성능의 변화 추이
    - 마이크로칩의 밀도가 24개월마다 2배로 늘어난다는 무어의 법칙으로 20년간 컴퓨터 성능의 변화 추이 그래프를 설명할 수 있음
    - 미래의 발전 방향을 예측할 수 있음
    - 기술이 바뀌어 가면서 컴퓨터 성능 개선의 추세가 반영됨
    - 변화 추세를 활용해 대략적인 발전 방향을 예측가능함
- 클러스터 제작
  - HPC cluster 제작 방식(계층구조) 
    - chip(2 processors) - board(8 chips) - board(8 chips) - system(64 cabinets)
      - 캐비넷 : 육면체 하나하나가 여러 개의 보드가 꽂혀있는 길쭉한 육면체
      - 캐비넷 한 개 안에는 보드들이 위아래로 꽂혀 있음
      - 보드 안에는 여러 개의 칩들이 꽂혀있고 회로가 연결되어 있음. 그 안에 프로세서가 여러 개 들어가 있고 메모리가 많이 꽂혀 있음
      - 한 칩 안에 프로세서 2개가 들어가있고 거기에 같이 사용하는 RAM이 들어가 있음
      - 이 것을 복제해서 보드를 만들고 보드를 여러장해서 캐비넷에 끼우고 캐비넷 여러개를 연걸하면 이게 전체 클러스트의 최종 구조
    - 1990년대부터 시작된 오래된 기술로 BLUE GENE/L을 만들 때 사용되었던 기술임 (블루진은 왓슨 컴퓨터의 전신)
    - 슈퍼 컴퓨터 제작방식에서도 사용되고 있음
    - 특이한 것은 특화된 보드 하드웨어가 그래픽 가속 장치, 영상 가속 장치. 요즘에는 CPU하나만 가지고 가는 게 아니라 가속장치를 CPU 옆에 같이 장착해서 연산은 CPU가 하지만 다량의 실수 연산할 때는 가속장치 쪽으로 보내서 거기서 처리해서 다시 돌아오는 과정을 거쳐서 속도를 개선하는 기술이 쓰임
  - Parallel Computer (패러렐 컴퓨터) 유형
    - 클러스터나 병렬 컴퓨터를 만들 때 두 가지 서로 다른 방식이 있음
      - 공유 메모리 기반 병렬 컴퓨터(Shared memory multiprocessor)
      - 분산 메모리 기반 병렬 컴퓨터(Distributed memory multicomputer)
        - 클러스터들은 대게 분산 메모리 기반의 병렬 컴퓨터 형식으로 만들어 짐
      - Interconnection network : 동시에 같은 일을 나눠서 처리하기 위해 그들 사이에 데이터 교환이나 협력을 하는 체제. 독자적 실행가능한 개개 컴퓨터를 고속 연결망으로 결합한 체제.
- 클러스터 연결구조
  - 버스형 / LAN  연결형 / 고속망
  - 특수연결망 : INFINBAND
- Beowulf Clusters
  - LINUX OS. 계열의 소프트웨어를 사용
- 소규모 클러스터 제작 - 하드웨어
  - Commodity clsuter
    - 복수의 PC (last CPU. > 4GB RAM. > 500GB HDD/SDD), Keyboard, Mouse, LAN
    - Gigabit Ethemet Switch
    - (GPGPU boards)
    - 여러 개 pc를 조립된 것 사와서. 안에는 프로세서, 충분한 양의 RAM, 하드디스크 or SSD, 1대는 완벽하게 키보드 마우스, 이더넷 랜선 연결:이더넷 허브를 써도 되지만 스위치 쓰는 것이 성능 더 우수. 추가적으로 가속 장치 붙여주면 좋음. 
- 소규모 클러스터 제작 - 소프트웨어
  - 소프트웨어는 리눅스(한 컴퓨터의 내부만 관할)에 컴퓨터와 컴퓨터 사이에 데이터를 주고 받고 하기 위해선 별도의 소프트 웨어 필요. 이게 mpi라고 하는 이름의 통신 소프트웨어 
- 제작 절차 (linux cluster)
  - Bare machine 구비
  - Linux operating system 설치
  - MPI library (설치파일) download, 컴파일 및 초기 설정 (machine file 등)
  - 테스트 프로그램 실행
  - 사용자 설정
- 소규모 클러스트 제작
  - 한 대의 멀티코어 컴퓨터도 리눅스 체제를 사용해 병렬 환경을 만들어 클로스터를 제작 가능함
  - 멀티 코어 : 부분적으로 코어들이 달리 존재. 이 코어들이 공유하는 시설도 있지만 컴퓨팅 하는 거 자체는 다 별도로 있음.
- MPI library
  - MPI 집합 통신과 같은 다양한 통신 방식을 함수를 통해 구현할 수 있음
- 병렬 수행 프로그램 설계는 어떻게 할까
  - 순차실행
    - C프로그램
    - 기존의 프로그램 시리행 방식
  - 병렬 실행
    - 작업 분할
    - 개별/동시 작업
    - 중간/최종결과 교환/취합
  - 병렬 프로그램 작성/개발
    - 순차실행프로그램 이해
      - 작업분할 프로그램 제작
      - 각각의 컴퓨터 실행 코드/데이터 준비
      - 작업 실행
    - 병렬화 전략 / 알고리즘
    - 병렬화 전략으로 얻을 수 있는 스피드업 효과를 예측할 수 있음
    - 얼마만큼 빨라지는가
      - 두 대를 쓴다고 두 배 빨라지지는 않음. 병렬 작업 과정을 위해 추가한 오버헤드로 인해 손실이 발생함
      - 병렬 작업하면서 장애요소 즉, 약간 손실이 발생하기에. 통신과정에서 시간이 지연. 여럿이 하면서 데이터를 주고 받는 과정이니까 원래 작업에 필요한 부분이 아니기에 병렬로 하면서 추가한 것으로 들어가는 오버헤드이기에 그만큼 손해
      - 손실의 정도를 예상할 필요가 있음
      - 병렬 실행은 다양한 기술과 요소를 포함하는 복잡한 과정을 거침
- (병렬 실행) 테스트 프로그램
  - Hello.c 단순한 "Hello" 문장출력
  - cpi(computing ㅠ) : 적분법에 의한 ㅠ 계산
  - Matmul.c : 나수로 생성된 행렬 A,B에 대한 곱셈 실행(C=AB) 후 결과 확인